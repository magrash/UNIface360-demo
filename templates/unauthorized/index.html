<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unauthorized Area Dashboard</title>
    <link rel="icon" href="{{ url_for('static', filename='logo6.png') }}" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles_2.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style> .ltr { direction: ltr; }</style>
    <script defer src="{{ url_for('static', filename='dashboard.js') }}"></script>
</head>
<body class="dashboard">
    {% include 'unauthorized/_navbar.html' %}

    <div class="container-fluid">
        <div class="row">
            {% include 'unauthorized/_sidebar.html' %}

            <main class="col-12 col-lg-10 p-3 p-lg-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="m-0">Unauthorized Area Dashboard</h3>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline" id="exportDashboardCsv"><i class="fa-solid fa-download"></i> Export CSV</button>
                        <button class="btn btn-gradient" id="exportDashboardPdf"><i class="fa-solid fa-file-pdf"></i> Export PDF</button>
                    </div>
                </div>

                <!-- Key Performance Indicators -->
                <div class="row g-3 mb-3">
                    <div class="col-6 col-lg-3">
                        <div class="glass-card p-3 kpi h-100">
                            <div class="icon danger">üî•</div>
                            <div>
                                <div class="value">12</div>
                                <div class="label">Today's Violations</div>
                                <small class="text-danger d-block mt-1"><i class="fa-solid fa-arrow-up"></i> +3 vs yesterday</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="glass-card p-3 kpi h-100">
                            <div class="icon warning">‚ö†Ô∏è</div>
                            <div>
                                <div class="value">87</div>
                                <div class="label">This Month</div>
                                <small class="text-warning d-block mt-1"><i class="fa-solid fa-arrow-up"></i> +15% vs last month</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="glass-card p-3 kpi h-100">
                            <div class="icon primary">‚ùó</div>
                            <div>
                                <div class="value">5</div>
                                <div class="label">Critical Today</div>
                                <small class="text-primary d-block mt-1"><i class="fa-solid fa-exclamation-triangle"></i> Requires action</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="glass-card p-3 kpi h-100">
                            <div class="icon success">‚úÖ</div>
                            <div>
                                <div class="value">23</div>
                                <div class="label">Resolved Today</div>
                                <small class="text-success d-block mt-1"><i class="fa-solid fa-arrow-up"></i> +8 this week</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Hot Zones & High-Risk Employees -->
                <div class="row g-3 mb-3">
                    <div class="col-lg-6">
                        <div class="glass-card p-3 h-100 d-flex flex-column">
                            <div class="section-title mb-3">Top 5 Hot Zones</div>
                            <div class="flex-grow-1">
                                <div class="d-flex flex-column gap-2">
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(239,68,68,0.15); border-radius:8px; border-left:3px solid #ef4444;">
                                        <div>
                                            <div class="fw-semibold">Warehouse Zone A</div>
                                            <div class="text-muted small">15 violations this month</div>
                                        </div>
                                        <span class="badge bg-danger">Critical</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(245,158,11,0.15); border-radius:8px; border-left:3px solid #f59e0b;">
                                        <div>
                                            <div class="fw-semibold">Chemical Storage</div>
                                            <div class="text-muted small">12 violations this month</div>
                                        </div>
                                        <span class="badge bg-warning">High</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(245,158,11,0.15); border-radius:8px; border-left:3px solid #f59e0b;">
                                        <div>
                                            <div class="fw-semibold">Confined Space #3</div>
                                            <div class="text-muted small">9 violations this month</div>
                                        </div>
                                        <span class="badge bg-warning">High</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(59,130,246,0.15); border-radius:8px; border-left:3px solid #3b82f6;">
                                        <div>
                                            <div class="fw-semibold">High Voltage Room</div>
                                            <div class="text-muted small">7 violations this month</div>
                                        </div>
                                        <span class="badge bg-info">Medium</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(59,130,246,0.15); border-radius:8px; border-left:3px solid #3b82f6;">
                                        <div>
                                            <div class="fw-semibold">Roof Access Point</div>
                                            <div class="text-muted small">6 violations this month</div>
                                        </div>
                                        <span class="badge bg-info">Medium</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="glass-card p-3 h-100 d-flex flex-column">
                            <div class="section-title mb-3">Top High-Risk Employees</div>
                            <div class="flex-grow-1">
                                <div class="d-flex flex-column gap-2">
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(239,68,68,0.15); border-radius:8px;">
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="avatar" style="width:40px;height:40px;background:#ef4444;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">AM</div>
                                            <div>
                                                <div class="fw-semibold">Ahmed Mohamed</div>
                                                <div class="text-muted small">Operations - 8 violations</div>
                                            </div>
                                        </div>
                                        <span class="badge bg-danger">Critical</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(245,158,11,0.15); border-radius:8px;">
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="avatar" style="width:40px;height:40px;background:#f59e0b;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">SK</div>
                                            <div>
                                                <div class="fw-semibold">Sara Khaled</div>
                                                <div class="text-muted small">Maintenance - 6 violations</div>
                                            </div>
                                        </div>
                                        <span class="badge bg-warning">High</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(245,158,11,0.15); border-radius:8px;">
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="avatar" style="width:40px;height:40px;background:#f59e0b;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">MH</div>
                                            <div>
                                                <div class="fw-semibold">Mohamed Hassan</div>
                                                <div class="text-muted small">Warehouse - 5 violations</div>
                                            </div>
                                        </div>
                                        <span class="badge bg-warning">High</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(59,130,246,0.15); border-radius:8px;">
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="avatar" style="width:40px;height:40px;background:#3b82f6;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">NA</div>
                                            <div>
                                                <div class="fw-semibold">Nour Ali</div>
                                                <div class="text-muted small">IT - 4 violations</div>
                                            </div>
                                        </div>
                                        <span class="badge bg-info">Medium</span>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between p-2" style="background:rgba(59,130,246,0.15); border-radius:8px;">
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="avatar" style="width:40px;height:40px;background:#3b82f6;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;">YM</div>
                                            <div>
                                                <div class="fw-semibold">Youssef Mostafa</div>
                                                <div class="text-muted small">Security - 3 violations</div>
                                            </div>
                                        </div>
                                        <span class="badge bg-info">Medium</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 1: Violations by Department & Location Heatmap -->
                <div class="row g-3 mb-3">
                    <div class="col-lg-6">
                        <div class="glass-card p-3 h-100 d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="section-title">Violations by Department</div>
                                <select class="form-select form-select-sm" style="width:auto" id="deptTimeRange">
                                    <option>This Month</option>
                                    <option>Last Month</option>
                                    <option>Last 3 Months</option>
                                    <option>This Year</option>
                                </select>
                            </div>
                            <div class="flex-grow-1 d-flex align-items-center">
                                <canvas id="deptPieChart" height="200" class="ltr"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="glass-card p-3 h-100 d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="section-title">Violations by Location (Heatmap)</div>
                                <button class="btn btn-sm btn-outline" id="refreshHeatmap"><i class="fa-solid fa-refresh"></i></button>
                            </div>
                            <div class="flex-grow-1" style="min-height:250px;">
                                <div id="locationHeatmap" style="height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px;">
                                    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;width:100%;max-width:400px;">
                                        <div style="background:#10b981;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 1<br><small>2</small></div>
                                        <div style="background:#f59e0b;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 2<br><small>8</small></div>
                                        <div style="background:#ef4444;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 3<br><small>15</small></div>
                                        <div style="background:#3b82f6;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 4<br><small>5</small></div>
                                        <div style="background:#10b981;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 5<br><small>1</small></div>
                                        <div style="background:#f59e0b;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 6<br><small>7</small></div>
                                        <div style="background:#3b82f6;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 7<br><small>4</small></div>
                                        <div style="background:#ef4444;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 8<br><small>12</small></div>
                                        <div style="background:#10b981;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 9<br><small>3</small></div>
                                        <div style="background:#f59e0b;padding:20px;border-radius:8px;text-align:center;color:white;font-weight:bold;font-size:0.8rem;">Zone 10<br><small>6</small></div>
                                    </div>
                                    <div class="d-flex gap-3 mt-2">
                                        <small><span style="display:inline-block;width:12px;height:12px;background:#10b981;border-radius:3px;margin-right:4px;"></span> Low (1-3)</small>
                                        <small><span style="display:inline-block;width:12px;height:12px;background:#3b82f6;border-radius:3px;margin-right:4px;"></span> Medium (4-7)</small>
                                        <small><span style="display:inline-block;width:12px;height:12px;background:#f59e0b;border-radius:3px;margin-right:4px;"></span> High (8-11)</small>
                                        <small><span style="display:inline-block;width:12px;height:12px;background:#ef4444;border-radius:3px;margin-right:4px;"></span> Critical (12+)</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trends Chart -->
                <div class="row g-3 mb-3">
                    <div class="col-12">
                        <div class="glass-card p-3 h-100 d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="section-title">Violations Trends</div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline active" data-period="day">Today</button>
                                    <button class="btn btn-sm btn-outline" data-period="week">Week</button>
                                    <button class="btn btn-sm btn-outline" data-period="month">Month</button>
                                    <button class="btn btn-sm btn-outline" data-period="year">Year</button>
                                </div>
                            </div>
                            <div class="flex-grow-1 d-flex align-items-center">
                                <canvas id="trendsChart" height="80" class="ltr"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Severity Breakdown -->
                <div class="row g-3">
                    <div class="col-lg-6">
                        <div class="glass-card p-3 h-100 d-flex flex-column">
                            <div class="section-title mb-3">Severity Breakdown</div>
                            <div class="flex-grow-1 d-flex align-items-center">
                                <canvas id="severityChart" height="200" class="ltr"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="glass-card p-3 h-100 d-flex flex-column">
                            <div class="section-title mb-3">Recent Violations</div>
                            <div class="flex-grow-1">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Time</th>
                                                <th>Type</th>
                                                <th>Location</th>
                                                <th>Person</th>
                                                <th>Severity</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>10:23 AM</td>
                                                <td>Unauthorized Entry</td>
                                                <td>Warehouse Zone A</td>
                                                <td>Ahmed Mohamed</td>
                                                <td><span class="badge bg-danger">Critical</span></td>
                                                <td><span class="badge bg-warning">Under Investigation</span></td>
                                            </tr>
                                            <tr>
                                                <td>09:45 AM</td>
                                                <td>Unsafe Action</td>
                                                <td>Chemical Storage</td>
                                                <td>Sara Khaled</td>
                                                <td><span class="badge bg-warning">High</span></td>
                                                <td><span class="badge bg-info">Open</span></td>
                                            </tr>
                                            <tr>
                                                <td>08:12 AM</td>
                                                <td>Confined Space Entry</td>
                                                <td>Confined Space #3</td>
                                                <td>Mohamed Hassan</td>
                                                <td><span class="badge bg-warning">High</span></td>
                                                <td><span class="badge bg-success">Closed</span></td>
                                            </tr>
                                            <tr>
                                                <td>07:30 AM</td>
                                                <td>Working at Height</td>
                                                <td>Roof Access Point</td>
                                                <td>Nour Ali</td>
                                                <td><span class="badge bg-info">Medium</span></td>
                                                <td><span class="badge bg-info">Open</span></td>
                                            </tr>
                                            <tr>
                                                <td>06:15 AM</td>
                                                <td>Hazardous Material</td>
                                                <td>High Voltage Room</td>
                                                <td>Youssef Mostafa</td>
                                                <td><span class="badge bg-info">Medium</span></td>
                                                <td><span class="badge bg-warning">Under Investigation</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Get chart text color based on theme
        function getChartTextColor() {
            return document.body.classList.contains('light-theme') ? '#0f172a' : '#e2e8f0';
        }
        
        // Department Pie Chart
        const deptCtx = document.getElementById('deptPieChart');
        if(deptCtx) {
            new Chart(deptCtx, {
                type: 'pie',
                data: {
                    labels: ['Operations', 'Maintenance', 'Warehouse', 'IT', 'Security', 'Other'],
                    datasets: [{
                        data: [28, 22, 18, 12, 8, 12],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',      // Danger (red)
                            'rgba(245, 158, 11, 0.8)',     // Warning (orange)
                            'rgba(0, 152, 121, 0.8)',      // Primary (green)
                            'rgba(16, 185, 129, 0.8)',     // Success (emerald)
                            'rgba(0, 196, 167, 0.8)',      // Primary-2 (teal)
                            'rgba(148, 163, 184, 0.8)'     // Muted (slate)
                        ],
                        borderWidth: 2,
                        borderColor: 'var(--card)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: getChartTextColor(), padding: 15 }
                        }
                    }
                }
            });
        }

        // Trends Line Chart
        const trendsCtx = document.getElementById('trendsChart');
        if(trendsCtx) {
            const trendsChart = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Violations',
                        data: [8, 12, 15, 10, 14, 9, 12],
                        borderColor: '#009879',  // Primary green
                        backgroundColor: 'rgba(0, 152, 121, 0.1)',  // Primary green with opacity
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: getChartTextColor() },
                            grid: { color: document.body.classList.contains('light-theme') ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)' }
                        },
                        x: {
                            ticks: { color: getChartTextColor() },
                            grid: { color: document.body.classList.contains('light-theme') ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });

            // Period buttons
            document.querySelectorAll('[data-period]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-period]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    // Update chart data based on period
                });
            });
        }

        // Severity Chart
        const severityCtx = document.getElementById('severityChart');
        if(severityCtx) {
            new Chart(severityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Low', 'Medium', 'High', 'Critical'],
                    datasets: [{
                        data: [15, 25, 30, 10],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',     // Success (emerald) - Low
                            'rgba(0, 152, 121, 0.8)',      // Primary (green) - Medium
                            'rgba(245, 158, 11, 0.8)',    // Warning (orange) - High
                            'rgba(239, 68, 68, 0.8)'      // Danger (red) - Critical
                        ],
                        borderWidth: 2,
                        borderColor: 'var(--card)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: getChartTextColor(), padding: 15 }
                        }
                    }
                }
            });
        }

        // Export functions
        document.getElementById('exportDashboardCsv')?.addEventListener('click', function() {
            alert('CSV export functionality - to be implemented');
        });
        document.getElementById('exportDashboardPdf')?.addEventListener('click', function() {
            alert('PDF export functionality - to be implemented');
        });
    </script>
</body>
</html>

